<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com https://google-analytics.com https://aqemezlbkktmtbxwqjtk.supabase.co; connect-src 'self' https://www.google-analytics.com https://www.googletagmanager.com https://google-analytics.com https://aqemezlbkktmtbxwqjtk.supabase.co; base-uri 'self'; frame-ancestors 'none'; upgrade-insecure-requests">
<title>Invoice Finder 2026 - Find Your Perfect Invoicing Tool for Freelancers</title>
<meta name="description" content="Find your perfect invoicing tool in 2 clicks. Real freelancer reviews, Top 5 charts, intelligent recommendations for 2026.">
<meta name="keywords" content="invoicing software freelancer, AI invoices, automated invoices, freelancer tools, free invoicing software">
<meta name="google-site-verification" content="Wo_6LQQ8LoGlobalzVMjBHh_Z-VD3N_dFdqCZb2BYxV0" />
<link rel="canonical" href="https://billr-ai.github.io/Ki-Tools-Freelancer/">
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
<meta property="og:type" content="website">
<meta property="og:title" content="Invoice Finder 2026 - Find Your Perfect Invoicing Tool for Freelancers">
<meta property="og:description" content="Find your perfect invoicing tool in 2 clicks. Real freelancer reviews, Top 5 charts, intelligent recommendations.">
<meta property="og:url" content="https://billr-ai.github.io/Ki-Tools-Freelancer/">
<meta property="og:site_name" content="Invoice Finder">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Invoice Finder 2026">
<meta name="twitter:description" content="Find your perfect invoicing tool in 2 clicks">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BSC0RCF1MJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-BSC0RCF1MJ', {
    anonymize_ip: true,
    page_title: document.title,
    page_location: window.location.href,
    page_path: window.location.pathname,
    send_page_view: true
  });
</script>

<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Invoice Finder",
  "url": "https://billr-ai.github.io/Ki-Tools-Freelancer/",
  "description": "Find your perfect invoicing tool for freelancers in 2 clicks. Real user reviews, Top 5 charts, intelligent recommendations.",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://billr-ai.github.io/Ki-Tools-Freelancer/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

<style>
/* Dein bestehender CSS bleibt komplett unver√§ndert */
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --primary:#3b82f6;
  --primary-light:#60a5fa;
  --primary-dark:#2563eb;
  --secondary:#10b981;
  --secondary-light:#34d399;
  --secondary-dark:#059669;
  --accent:#38bdf8;
  --danger:#ef4444;
  --danger-light:#f87171;
  --forum:#8b5cf6;
  --forum-light:#a78bfa;
  --dark:#020617;
  --dark-light:#0f172a;
  --text:#1e293b;
  --text-dark:#0f172a;
  --text-muted:#475569;
  --card-bg:rgba(255, 255, 255, 1);
  --card-border:rgba(203, 213, 225, 0.6);
  --glass:rgba(255,255,255,0.1);
  --shadow:0 8px 20px rgba(0,0,0,0.12);
  --radius:12px;
  --transition:all 0.25s ease
}
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#f1f5f9 0%,#e2e8f0 100%);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  line-height:1.4;
}
.language-switch{position:fixed;top:15px;right:15px;z-index:1000}
.lang-btn{background:white;border:2px solid var(--primary);color:var(--primary);padding:8px 16px;border-radius:var(--radius);cursor:pointer;display:flex;align-items:center;gap:6px;font-weight:600;transition:var(--transition);font-size:0.9rem;box-shadow:var(--shadow)}
.lang-btn:hover{background:var(--primary);color:white;transform:translateY(-2px)}
.header{padding:60px 20px 20px;text-align:center;max-width:1200px;margin:0 auto}
.badge{background:linear-gradient(135deg,var(--primary),var(--accent));color:white;padding:8px 18px;border-radius:20px;font-size:0.9rem;font-weight:600;display:inline-block;margin-bottom:20px;animation:float 3s ease-in-out infinite;box-shadow:0 4px 12px rgba(59,130,246,0.3)}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
.header h1{font-size:clamp(2rem,4vw,3rem);margin-bottom:16px;line-height:1.1;color:var(--text-dark);font-weight:800}
.header p{font-size:1.1rem;color:var(--text-muted);max-width:600px;margin:0 auto 25px;line-height:1.6}
.search-container{max-width:700px;margin:0 auto 20px;position:relative}
.search-box{width:100%;padding:16px 20px 16px 52px;background:white;border:2px solid var(--card-border);border-radius:var(--radius);color:var(--text);font-size:1rem;transition:var(--transition);box-shadow:var(--shadow)}
.search-box:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
.search-icon{position:absolute;left:18px;top:50%;transform:translateY(-50%);color:var(--primary);font-size:1.2rem}
.search-suggestions{position:absolute;top:100%;left:0;right:0;background:white;border:2px solid var(--primary);border-top:none;border-radius:0 0 var(--radius) var(--radius);max-height:280px;overflow-y:auto;z-index:100;display:none;box-shadow:var(--shadow)}
.search-suggestions.active{display:block}
.suggestion-item{padding:12px 18px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--card-border)}
.suggestion-item:hover{background:rgba(59,130,246,0.08)}
.suggestion-icon{color:var(--primary);width:20px;font-size:1rem}
.suggestion-text{flex:1;display:flex;flex-direction:column;gap:4px}
.suggestion-name{color:var(--text-dark);font-weight:700;font-size:1rem}
.suggestion-meta{font-size:0.85rem;color:var(--text-muted)}
.search-tips-wrapper{max-width:700px;margin:12px auto 0;position:relative}
.search-tips{display:flex;align-items:center;flex-wrap:wrap;gap:6px;min-height:24px;padding:0 5px}
.search-tips-label{color:var(--text-muted);font-size:0.8rem;margin-right:8px;white-space:nowrap;flex-shrink:0}
.search-tip-item{background:rgba(59,130,246,0.08);padding:3px 10px;border-radius:14px;cursor:pointer;transition:var(--transition);border:1px solid transparent;white-space:nowrap;font-size:0.78rem;flex-shrink:0}
.search-tip-item:hover{background:rgba(59,130,246,0.15);border-color:var(--primary-light);transform:translateY(-1px)}
.search-tip-item.active{background:rgba(59,130,246,0.2);border-color:var(--primary);font-weight:600}
.search-tips-scroll-btn{position:absolute;top:50%;transform:translateY(-50%);background:white;border:1px solid var(--card-border);width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:2;color:var(--primary);font-size:0.7rem;opacity:0.8;transition:var(--transition);box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.search-tips-scroll-btn:hover{opacity:1;background:var(--primary);color:white;border-color:var(--primary)}
.search-tips-scroll-btn.left{left:-30px}
.search-tips-scroll-btn.right{right:-30px}
.search-tips-scroll-btn.hidden{display:none}
.quick-navigation{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;max-width:1200px;margin:0 auto 30px;padding:0 20px}
.quick-card{background:white;border-radius:var(--radius);padding:20px;border:2px solid var(--card-border);display:flex;flex-direction:column;align-items:center;text-align:center;cursor:pointer;box-shadow:var(--shadow)}
.quick-card:hover{transform:translateY(-5px);border-color:var(--primary);box-shadow:0 12px 25px rgba(59,130,246,0.15)}
.quick-card.active{background:linear-gradient(135deg, var(--primary-light), var(--primary));border-color:var(--primary);color:white;}
.quick-card.active .quick-title,
.quick-card.active .quick-desc{color:white;}
.quick-card.active .quick-icon{background:rgba(255,255,255,0.2);color:white;}
.quick-icon{width:48px;height:48px;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:12px;display:flex;align-items:center;justify-content:center;margin-bottom:15px;font-size:1.4rem;color:white}
.quick-title{font-size:1rem;font-weight:700;color:var(--text-dark);margin-bottom:6px}
.quick-desc{font-size:0.85rem;color:var(--text-muted);line-height:1.4}
.top-charts-section{max-width:1200px;margin:0 auto 30px;padding:0 20px}
.section-title{display:flex;align-items:center;gap:10px;font-size:1.3rem;font-weight:800;color:var(--text-dark);margin-bottom:20px}
.section-title i{color:var(--primary);font-size:1.1rem}
.top-charts{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
.chart-card{background:white;border-radius:var(--radius);padding:20px;border:2px solid var(--card-border);box-shadow:var(--shadow);transition:transform 0.5s ease, opacity 0.5s ease;}
.chart-card.moving-up{border-color:var(--secondary);box-shadow:0 0 0 2px var(--secondary), 0 8px 25px rgba(16,185,129,0.25);}
.chart-card.moving-down{border-color:var(--danger);box-shadow:0 0 0 2px var(--danger), 0 8px 25px rgba(239,68,68,0.25);}
.chart-card.fade-out{opacity:0.4;transform:scale(0.98);}
.chart-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.chart-rank{width:36px;height:36px;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:1rem;color:white;transition:all 0.5s ease;}
.chart-rank.moving-up{background:linear-gradient(135deg,var(--secondary),var(--secondary-light));transform:scale(1.1);}
.chart-rank.moving-down{background:linear-gradient(135deg,var(--danger),var(--danger-light));transform:scale(1.1);}
.chart-rank.rank-1{background:linear-gradient(135deg,#f59e0b,#d97706)}
.chart-rank.rank-2{background:linear-gradient(135deg:#94a3b8,#64748b)}
.chart-rank.rank-3{background:linear-gradient(135deg:#fbbf24,#f59e0b)}
.chart-votes{display:flex;align-items:center;gap:6px;font-size:0.9rem;color:var(--text-muted)}
.chart-votes i{color:var(--secondary)}
.chart-tool-name{font-weight:800;font-size:1.1rem;color:var(--text-dark);margin-bottom:6px}
.chart-category{font-size:0.8rem;color:var(--primary);font-weight:600;background:rgba(59,130,246,0.1);padding:4px 10px;border-radius:20px;display:inline-block}
.chart-price{font-size:1rem;color:var(--secondary);font-weight:700;margin:10px 0}
.chart-description{font-size:0.9rem;color:var(--text-muted);line-height:1.5;margin-bottom:16px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.chart-pros-cons{margin:12px 0;font-size:0.85rem;}
.pros-list, .cons-list{margin:6px 0;}
.pros-list li:before{content:"‚úì ";color:var(--secondary);font-weight:bold;}
.cons-list li:before{content:"‚úó ";color:var(--danger);font-weight:bold;}
.chart-actions{display:flex;gap:10px}
.vote-btn{flex:1;background:rgba(255,255,255,0.05);border:2px solid var(--card-border);border-radius:8px;padding:12px;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:8px;font-size:1rem;font-weight:600;color:var(--text)}
.vote-btn i{font-size:1.2rem}
.vote-btn.up:hover{background:rgba(16,185,129,0.1);border-color:var(--secondary);color:var(--secondary)}
.vote-btn.down:hover{background:rgba(239,68,68,0.1);border-color:var(--danger);color:var(--danger)}
.vote-btn.active.up{background:rgba(16,185,129,0.15);border-color:var(--secondary);color:var(--secondary)}
.vote-btn.active.down{background:rgba(239,68,68,0.15);border-color:var(--danger);color:var(--danger)}
.vote-btn.removing{opacity:0.5;transform:scale(0.95);}
.vote-count-animation{animation:countChange 0.6s ease;}
@keyframes countChange{0%{transform:scale(1);}50%{transform:scale(1.3);}100%{transform:scale(1);}}

/* Forum Section */
.forum-section{max-width:1200px;margin:40px auto;padding:0 20px;}
.forum-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:25px;flex-wrap:wrap;gap:15px;}
.forum-title{display:flex;align-items:center;gap:10px;font-size:1.5rem;font-weight:800;color:var(--text-dark);}
.forum-title i{color:var(--forum);}
.forum-stats{display:flex;gap:20px;font-size:0.9rem;color:var(--text-muted);}
.forum-stat{display:flex;align-items:center;gap:5px;}
.forum-tabs{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:20px;}
.forum-tab{background:white;border:2px solid var(--card-border);color:var(--text-muted);padding:10px 18px;border-radius:20px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600;transition:var(--transition);white-space:nowrap;font-size:0.9rem;}
.forum-tab:hover{border-color:var(--forum);color:var(--forum);}
.forum-tab.active{background:linear-gradient(135deg,var(--forum),var(--forum-light));border-color:transparent;color:white;}
.forum-container{display:grid;grid-template-columns:1fr;gap:20px;}
.forum-card{background:white;border-radius:var(--radius);padding:20px;border:2px solid var(--card-border);box-shadow:var(--shadow);}
.forum-card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:15px;}
.forum-author{display:flex;align-items:center;gap:10px;}
.forum-avatar{width:36px;height:36px;background:linear-gradient(135deg,var(--forum),var(--forum-light));border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:0.9rem;}
.forum-author-info{display:flex;flex-direction:column;}
.forum-author-name{font-weight:700;color:var(--text-dark);font-size:0.95rem;}
.forum-time{font-size:0.8rem;color:var(--text-muted);}
.forum-tool-badge{background:rgba(59,130,246,0.1);color:var(--primary);padding:4px 10px;border-radius:20px;font-size:0.75rem;font-weight:600;}
.forum-content{margin-bottom:15px;line-height:1.6;}
.forum-actions{display:flex;align-items:center;gap:15px;padding-top:15px;border-top:1px solid var(--card-border);}
.forum-action-btn{display:flex;align-items:center;gap:5px;background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:0.85rem;transition:var(--transition);padding:5px 10px;border-radius:6px;}
.forum-action-btn:hover{color:var(--primary);background:rgba(59,130,246,0.1);}
.forum-action-btn.liked{color:var(--danger);}
.forum-action-btn.commented{color:var(--forum);}
.forum-reply-section{margin-top:15px;padding-top:15px;border-top:1px solid var(--card-border);}
.forum-reply-form{display:flex;gap:10px;margin-bottom:15px;}
.forum-reply-input{flex:1;padding:12px 16px;background:#f8fafc;border:2px solid var(--card-border);border-radius:var(--radius);font-size:0.9rem;transition:var(--transition);}
.forum-reply-input:focus{outline:none;border-color:var(--forum);}
.forum-reply-btn{background:linear-gradient(135deg,var(--forum),var(--forum-light));color:white;border:none;padding:12px 20px;border-radius:8px;font-weight:600;cursor:pointer;transition:var(--transition);}
.forum-reply-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(139,92,246,0.3);}
.forum-replies{display:none;}
.forum-replies.active{display:block;}
.forum-reply{background:#f8fafc;border-radius:var(--radius);padding:15px;margin-top:10px;border-left:3px solid var(--forum-light);}
.forum-reply-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.forum-new-post-btn{background:linear-gradient(135deg,var(--forum),var(--forum-light));color:white;border:none;padding:12px 24px;border-radius:8px;font-weight:700;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:8px;margin-top:20px;}
.forum-new-post-btn:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(139,92,246,0.3);}

/* Tool Discussion Panel */
.tool-discussion-panel{display:none;grid-template-columns:1fr;gap:15px;margin-top:15px;padding-top:15px;border-top:1px solid var(--card-border);}
.tool-discussion-panel.active{display:grid;}
.discussion-header{display:flex;align-items:center;justify-content:space-between;}
.discussion-count{display:flex;align-items:center;gap:5px;font-size:0.9rem;color:var(--text-muted);}
.discussion-count i{color:var(--forum);}
.discussion-content{max-height:200px;overflow-y:auto;padding-right:10px;}
.discussion-item{background:#f8fafc;border-radius:8px;padding:12px;margin-bottom:10px;}
.discussion-item-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.discussion-author{font-weight:600;color:var(--text-dark);font-size:0.9rem;}
.discussion-time{font-size:0.75rem;color:var(--text-muted);}
.discussion-text{font-size:0.9rem;line-height:1.5;color:var(--text);}
.discussion-form{display:flex;gap:10px;}
.discussion-input{flex:1;padding:10px 14px;background:white;border:2px solid var(--card-border);border-radius:8px;font-size:0.9rem;transition:var(--transition);}
.discussion-input:focus{outline:none;border-color:var(--forum);}
.discussion-submit-btn{background:linear-gradient(135deg,var(--forum),var(--forum-light));color:white;border:none;padding:10px 18px;border-radius:8px;font-weight:600;cursor:pointer;transition:var(--transition);white-space:nowrap;}
.discussion-submit-btn:hover{transform:translateY(-2px);box-shadow:0 4px 10px rgba(139,92,246,0.3);}
.discussion-toggle-btn{background:rgba(139,92,246,0.1);color:var(--forum);border:2px solid var(--forum);padding:8px 16px;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;font-weight:600;transition:var(--transition);font-size:0.85rem;margin-top:10px;}
.discussion-toggle-btn:hover{background:var(--forum);color:white;}
.discussion-toggle-btn.active{background:var(--forum);color:white;}

.tools-container{max-width:1200px;margin:0 auto;padding:0 20px 50px}
.compact-tools-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:25px;flex-wrap:wrap;gap:15px}
.compact-filters{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
.filter-btn{background:white;border:2px solid var(--card-border);color:var(--text-muted);padding:10px 18px;border-radius:20px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600;transition:var(--transition);white-space:nowrap;font-size:0.9rem}
.filter-btn:hover{border-color:var(--primary);color:var(--primary)}
.filter-btn.active{background:linear-gradient(135deg,var(--primary),var(--accent));border-color:transparent;color:white;box-shadow:0 4px 12px rgba(59,130,246,0.3)}
.filter-select{padding:10px 35px 10px 15px;background:white;border:2px solid var(--card-border);border-radius:8px;color:var(--text);font-size:0.9rem;transition:var(--transition);cursor:pointer;appearance:none;min-width:160px;font-weight:600}
.filter-select:focus{outline:none;border-color:var(--primary)}
.filter-group{position:relative}
.filter-group::after{content:'‚ñº';position:absolute;right:15px;top:50%;transform:translateY(-50%);color:var(--primary);pointer-events:none;font-size:0.7rem}
.tools-count{font-size:1rem;color:var(--text-muted)}
.tools-count span{color:var(--primary);font-weight:800}
.compact-tools-grid{display:grid;grid-template-columns:1fr;gap:12px}
.compact-tool-row{background:white;border-radius:var(--radius);padding:18px;border:2px solid var(--card-border);transition:var(--transition);display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:15px;box-shadow:var(--shadow)}
.compact-tool-row:hover{border-color:var(--primary);transform:translateY(-3px);box-shadow:0 12px 25px rgba(59,130,246,0.1)}
.tool-vote-compact{display:flex;flex-direction:column;align-items:center;gap:8px;min-width:60px}
.vote-count{font-weight:800;font-size:1.1rem;color:var(--text-dark);transition:all 0.3s ease;}
.vote-count.upvoted{color:var(--secondary);}
.vote-count.downvoted{color:var(--danger);}
.vote-btn-compact{background:transparent;border:none;color:var(--text-muted);cursor:pointer;transition:var(--transition);padding:8px;border-radius:6px;font-size:1.4rem}
.vote-btn-compact:hover{color:var(--primary)}
.vote-btn-compact.active.up{color:var(--secondary)}
.vote-btn-compact.active.down{color:var(--danger)}
.vote-btn-compact.removing{animation:fadeOut 0.4s ease;opacity:0.5;}
@keyframes fadeOut{from{opacity:1;}to{opacity:0.5;}}
.tool-info-compact{overflow:hidden}
.tool-name-row{display:flex;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap}
.tool-name-compact{font-weight:800;font-size:1.1rem;color:var(--text-dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tool-category-compact{font-size:0.75rem;color:var(--primary);font-weight:600;padding:4px 10px;background:rgba(59,130,246,0.1);border-radius:20px;white-space:nowrap}
.tool-desc-compact{font-size:0.9rem;color:var(--text-muted);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.tool-pros-cons-compact{font-size:0.85rem;color:var(--text-muted);margin-top:8px;line-height:1.4;}
.tool-pros-cons-compact span{font-weight:600;color:var(--primary);}
.tool-pros-cons-compact .pros{color:var(--secondary);}
.tool-pros-cons-compact .cons{color:var(--danger);}
.tool-meta-compact{display:flex;flex-direction:column;align-items:flex-end;gap:10px;min-width:160px}
.tool-price-compact{font-size:1rem;font-weight:800;color:var(--secondary)}
.tool-link-compact{background:linear-gradient(135deg,var(--primary),var(--accent));color:white;padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:700;transition:var(--transition);font-size:0.9rem;white-space:nowrap;text-align:center;box-shadow:0 4px 10px rgba(59,130,246,0.2)}
.tool-link-compact:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(59,130,246,0.3)}
.empty-state{text-align:center;padding:50px 20px;grid-column:1/-1}
.empty-state i{font-size:3.5rem;color:var(--text-muted);margin-bottom:20px;opacity:0.5}
.empty-state h3{font-size:1.5rem;margin-bottom:15px;color:var(--text-dark)}
.empty-state p{color:var(--text-muted);max-width:400px;margin:0 auto 25px;line-height:1.6;font-size:1rem}
.reset-btn{background:var(--primary);color:white;border:none;padding:12px 24px;border-radius:8px;font-weight:700;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:8px;font-size:1rem}
.reset-btn:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:0 6px 15px rgba(59,130,246,0.3)}
.footer{text-align:center;padding:40px 20px;border-top:2px solid var(--card-border);margin-top:30px;background:white}
.footer p{color:var(--text-muted);font-size:0.9rem;margin-bottom:8px}
.footer a{color:var(--primary);text-decoration:none;transition:var(--transition);font-size:0.9rem}
.footer a:hover{color:var(--primary-dark);text-decoration:underline}
.scroll-top{position:fixed;bottom:25px;right:25px;background:linear-gradient(135deg,var(--primary),var(--accent));color:white;width:50px;height:50px;border-radius:50%;display:none;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);z-index:999;box-shadow:0 6px 15px rgba(59,130,246,0.3)}
.scroll-top.visible{display:flex}
.scroll-top:hover{transform:translateY(-3px) scale(1.1)}

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1001;align-items:center;justify-content:center;padding:20px;}
.modal.active{display:flex;}
.modal-content{background:white;border-radius:var(--radius);padding:30px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 20px 40px rgba(0,0,0,0.2);}
.modal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.modal-title{font-size:1.5rem;font-weight:800;color:var(--text-dark);display:flex;align-items:center;gap:10px;}
.modal-title i{color:var(--forum);}
.modal-close{background:none;border:none;font-size:1.5rem;color:var(--text-muted);cursor:pointer;transition:var(--transition);padding:5px;}
.modal-close:hover{color:var(--danger);}
.modal-form{display:flex;flex-direction:column;gap:15px;}
.modal-label{font-weight:600;color:var(--text-dark);}
.modal-select,.modal-input,.modal-textarea{padding:12px 16px;background:#f8fafc;border:2px solid var(--card-border);border-radius:8px;font-size:0.95rem;transition:var(--transition);}
.modal-select:focus,.modal-input:focus,.modal-textarea:focus{outline:none;border-color:var(--forum);}
.modal-textarea{min-height:120px;resize:vertical;font-family:'Inter',sans-serif;}
.modal-submit{background:linear-gradient(135deg,var(--forum),var(--forum-light));color:white;border:none;padding:14px;border-radius:8px;font-weight:700;cursor:pointer;transition:var(--transition);font-size:1rem;}
.modal-submit:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(139,92,246,0.3);}

/* Supabase Notification */
.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  background: var(--primary);
  color: white;
  padding: 15px 20px;
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10000;
  box-shadow: var(--shadow);
  animation: slideIn 0.3s ease;
}

.notification.success {
  background: var(--secondary);
}

.notification.error {
  background: var(--danger);
}

.notification-close {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  padding: 0;
  font-size: 1rem;
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

@keyframes slideOut {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

.sync-button {
  background: var(--primary);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: var(--transition);
  margin-left: 15px;
}

.sync-button:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.shared-badge {
  background: linear-gradient(135deg, var(--forum), var(--forum-light));
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.7rem;
  font-weight: 600;
  margin-left: 10px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.supabase-status {
  position: fixed;
  bottom: 15px;
  left: 15px;
  background: var(--glass);
  backdrop-filter: blur(10px);
  padding: 8px 12px;
  border-radius: var(--radius);
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  gap: 6px;
  z-index: 999;
  border: 1px solid var(--card-border);
}

.supabase-status.online {
  color: var(--secondary);
}

.supabase-status.offline {
  color: var(--danger);
}

.supabase-status i {
  font-size: 0.7rem;
}

.data-refresh {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@media (max-width:768px){.header{padding:50px 15px 15px}.header h1{font-size:1.8rem}.header p{font-size:1rem}.quick-navigation{grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;padding:0 15px}.top-charts-section{padding:0 15px}.tools-container{padding:0 15px 30px}.compact-tools-header{flex-direction:column;align-items:stretch}.compact-filters{justify-content:center}.compact-tool-row{grid-template-columns:1fr;gap:12px}.tool-meta-compact{flex-direction:row;justify-content:space-between;align-items:center;min-width:auto;margin-top:10px}.tool-vote-compact{flex-direction:row;gap:15px;justify-content:center;min-width:auto;margin-bottom:10px}.forum-header{flex-direction:column;align-items:stretch;}.forum-stats{justify-content:center;}.search-tips{padding:0 2px;}.search-tip-item{padding:2px 8px;font-size:0.75rem;}.search-tips-scroll-btn{display:none !important;}.search-tips-label{font-size:0.75rem;margin-right:6px;}.modal-content{padding:20px;}.sync-button{margin:10px 0 0 0;}}
@media (max-width:480px){.header h1{font-size:1.6rem}.search-box{padding:14px 16px 14px 48px;font-size:0.95rem}.quick-navigation{grid-template-columns:1fr 1fr}.top-charts{grid-template-columns:1fr}.compact-tool-row{padding:15px}.vote-btn-compact{font-size:1.2rem}.forum-tabs{justify-content:center;}.supabase-status{bottom:70px;}}
</style>
</head>
<body>
<div class="language-switch">
<button class="lang-btn" id="langBtn" type="button" aria-label="Switch language">
<i class="fas fa-globe"></i>
<span id="langText">EN</span>
</button>
</div>
<div class="scroll-top" id="scrollTop" aria-label="Scroll to top">
<i class="fas fa-arrow-up"></i>
</div>

<!-- Forum Modal -->
<div class="modal" id="forumModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title"><i class="fas fa-comment-medical"></i> <span id="modalTitle">Start New Discussion</span></div>
<button class="modal-close" id="modalClose">&times;</button>
</div>
<form id="forumForm" class="modal-form">
<div>
<label class="modal-label" id="modalToolLabel">Select Tool</label>
<select id="modalToolSelect" class="modal-select" required>
<option value="" id="modalSelectDefault">-- Select Tool --</option>
</select>
</div>
<div>
<label class="modal-label" id="modalTitleLabel">Discussion Title</label>
<input type="text" id="modalTitleInput" class="modal-input" placeholder="e.g. Tax question about FreshBooks" required>
</div>
<div>
<label class="modal-label" id="modalContentLabel">Your Question or Discussion</label>
<textarea id="modalContentInput" class="modal-textarea" placeholder="Describe your question or start a discussion..." required></textarea>
</div>
<button type="submit" class="modal-submit" id="modalSubmit">Start Discussion</button>
</form>
</div>
</div>

<header class="header">
<div class="badge" id="badgeText">üöÄ 16 Invoicing Tools for 2026</div>
<h1 id="pageTitle">Find your perfect invoicing tool instantly</h1>
<p id="pageDescription">Real freelancer ratings, Top 5 charts, smart recommendations. No unnecessary scrolling.</p>
<div class="search-container">
<i class="fas fa-search search-icon"></i>
<input type="text" class="search-box" id="searchInput" autocomplete="off" placeholder="What do you want to achieve with your invoicing software?">
<div class="search-suggestions" id="searchSuggestions" role="listbox"></div>
</div>
<div class="search-tips-wrapper">
<div class="search-tips" id="searchTips">
<span class="search-tips-label" id="searchTipsLabel">Try:</span>
</div>
<button class="search-tips-scroll-btn left hidden" id="scrollLeftBtn">
<i class="fas fa-chevron-left"></i>
</button>
<button class="search-tips-scroll-btn right hidden" id="scrollRightBtn">
<i class="fas fa-chevron-right"></i>
</button>
</div>
</header>
<section class="quick-navigation" id="quickNav">
<div class="quick-card" data-usecase="automation">
<div class="quick-icon"><i class="fas fa-robot"></i></div>
<div class="quick-title" id="navAuto">Automation</div>
<div class="quick-desc" id="navAutoDesc">Auto-reminders, recurring invoices</div>
</div>
<div class="quick-card" data-usecase="time-tracking">
<div class="quick-icon"><i class="fas fa-clock"></i></div>
<div class="quick-title" id="navTime">Time Tracking</div>
<div class="quick-desc" id="navTimeDesc">Track time & convert to invoices</div>
</div>
<div class="quick-card" data-usecase="international">
<div class="quick-icon"><i class="fas fa-globe"></i></div>
<div class="quick-title" id="navIntl">International</div>
<div class="quick-desc" id="navIntlDesc">Multiple currencies, international taxes</div>
</div>
<div class="quick-card" data-usecase="mobile">
<div class="quick-icon"><i class="fas fa-mobile-alt"></i></div>
<div class="quick-title" id="navMobile">Mobile First</div>
<div class="quick-desc" id="navMobileDesc">Create invoices on the go</div>
</div>
<div class="quick-card" data-usecase="contracts">
<div class="quick-icon"><i class="fas fa-file-contract"></i></div>
<div class="quick-title" id="navContract">Contracts</div>
<div class="quick-desc" id="navContractDesc">Combine contracts & invoices</div>
</div>
<div class="quick-card" data-category="free">
<div class="quick-icon"><i class="fas fa-gift"></i></div>
<div class="quick-title" id="navFree">Free</div>
<div class="quick-desc" id="navFreeDesc">Top free invoicing tools</div>
</div>
</section>
<section class="top-charts-section">
<div class="section-title">
<i class="fas fa-trophy"></i> 
<span id="topChartsTitle">Top 5 Invoicing Tools - Community Ranking</span>
<span class="shared-badge">LIVE</span>
</div>
<div class="top-charts" id="topCharts"></div>
</section>

<!-- Community Forum Section -->
<section class="forum-section">
<div class="forum-header">
<div class="forum-title">
<i class="fas fa-comments"></i>
<span id="forumTitle">Community Forum</span>
<span class="shared-badge">LIVE</span>
</div>
<div class="forum-stats">
<div class="forum-stat">
<i class="fas fa-comment"></i>
<span id="forumDiscussionsCount">0</span> <span id="forumDiscussionsText">Discussions</span>
</div>
<div class="forum-stat">
<i class="fas fa-users"></i>
<span id="forumActiveUsers">0</span> <span id="forumActiveText">active users</span>
</div>
</div>
</div>
<div class="forum-tabs">
<button class="forum-tab active" data-forum-filter="all">
<i class="fas fa-globe"></i>
<span id="forumTabAll">All Discussions</span>
</button>
<button class="forum-tab" data-forum-filter="popular">
<i class="fas fa-fire"></i>
<span id="forumTabPopular">Popular</span>
</button>
<button class="forum-tab" data-forum-filter="recent">
<i class="fas fa-clock"></i>
<span id="forumTabRecent">Recent</span>
</button>
<button class="forum-tab" data-forum-filter="questions">
<i class="fas fa-question-circle"></i>
<span id="forumTabQuestions">Questions</span>
</button>
<button class="forum-tab" data-forum-filter="tips">
<i class="fas fa-lightbulb"></i>
<span id="forumTabTips">Tips & Tricks</span>
</button>
</div>
<button class="forum-new-post-btn" id="newDiscussionBtn">
<i class="fas fa-plus"></i>
<span id="newDiscussionText">Start New Discussion</span>
</button>
<div class="forum-container" id="forumContainer">
<div class="forum-card" style="text-align:center;padding:40px 20px;">
<i class="fas fa-comments" style="font-size:3rem;color:var(--text-muted);opacity:0.5;margin-bottom:20px;"></i>
<h3 style="margin-bottom:10px;color:var(--text-muted);">No discussions yet</h3>
<p style="color:var(--text-muted);margin-bottom:20px;">Be the first to start a discussion!</p>
<button class="forum-new-post-btn" id="newDiscussionBtn2">
<i class="fas fa-plus"></i>
<span id="newDiscussionText2">Start First Discussion</span>
</button>
</div>
</div>
</section>

<section class="tools-container">
<div class="compact-tools-header">
<div class="compact-filters">
<button class="filter-btn active" data-scope="all" type="button"><i class="fas fa-globe"></i> <span id="catAll">All</span></button>
<button class="filter-btn" data-category="basic" type="button"><i class="fas fa-file-invoice"></i> <span id="catBasic">Basic</span></button>
<button class="filter-btn" data-category="advanced" type="button"><i class="fas fa-chart-line"></i> <span id="catAdvanced">Advanced</span></button>
<button class="filter-btn" data-category="mobile" type="button"><i class="fas fa-mobile-alt"></i> <span id="catMobile">Mobile</span></button>
<button class="filter-btn" data-category="all-in-one" type="button"><i class="fas fa-box"></i> <span id="catAllInOne">All-in-One</span></button>
<button class="filter-btn" data-category="enterprise" type="button"><i class="fas fa-building"></i> <span id="catEnterprise">Enterprise</span></button>
</div>
<div class="compact-filters">
<div class="filter-group">
<select id="priceFilter" class="filter-select"></select>
</div>
<div class="filter-group">
<select id="sortFilter" class="filter-select"></select>
</div>
<button class="sync-button" id="refreshDataBtn">
<i class="fas fa-sync-alt"></i> <span id="refreshText">Refresh</span>
</button>
</div>
<div class="tools-count"><span id="toolCount">16</span> <span id="toolsText">Tools</span></div>
</div>
<div class="compact-tools-grid" id="toolsGrid"></div>
</section>

<footer class="footer">
<p id="footerCopy">¬© 2026 Invoice Finder | Community-driven invoicing tool recommendations</p>
<p id="footerDiscl">Ratings based on user feedback (Supabase). All data is shared across all users.</p>
<p><a href="#"><i class="fas fa-question-circle"></i> Help</a> | <a href="#"><i class="fas fa-envelope"></i> Feedback</a></p>
</footer>

<script>
// Supabase Konfiguration - DEINE DATEN
const SUPABASE_URL = 'https://aqemezlbkktmtbxwqjtk.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_lqM39_8HE_4I_vAi5-4iKA_2jKZZbkH';

// Invoice Tools Database - ALL 16 TOOLS
let invoiceTools = [
{
  id:1,
  name:"FreshBooks",
  category:"advanced",
  price:"paid",
  priceDisplay:{de:"ab 19‚Ç¨/Monat", en:"from $19/month"},
  rating:4.8,
  description:{de:"F√ºhrende L√∂sung f√ºr professionelle Freelancer mit Automatisierung.", en:"Leading solution for professional freelancers with automation."},
  detailedDescription:{de:"FreshBooks ist eine cloud-basierte Rechnungssoftware speziell f√ºr Freelancer und kleine Unternehmen. Sie bietet umfangreiche Automatisierungsfunktionen, professionelle Rechnungsvorlagen und eine intuitive Benutzeroberfl√§che.", en:"FreshBooks is a cloud-based invoicing software specifically for freelancers and small businesses. It offers extensive automation features, professional invoice templates, and an intuitive user interface."},
  features:["Auto-Erinnerungen","Zeiterfassung","Kundenportal"],
  pros:{de:["Sehr benutzerfreundlich", "Exzellente Automatisierung", "Gute Mobile Apps"], en:["Very user-friendly", "Excellent automation", "Good mobile apps"]},
  cons:{de:["Teurer als Alternativen", "Begrenzte Buchhaltungsfunktionen"], en:["More expensive than alternatives", "Limited accounting features"]},
  link:"https://freshbooks.com/",
  badge:"popular",
  useCases:["automation","time-tracking","international"],
  votes:0,
  userVote:0
},
{
  id:2,
  name:"Wave",
  category:"basic",
  price:"free",
  priceDisplay:{de:"Kostenlos", en:"Free forever"},
  rating:4.5,
  description:{de:"100% kostenlose Rechnungen mit integrierter Buchhaltung.", en:"100% free invoices with integrated accounting."},
  detailedDescription:{de:"Wave ist eine komplett kostenlose Rechnungssoftware mit integrierten Buchhaltungsfunktionen. Perfekt f√ºr Startups und Freelancer mit kleinem Budget.", en:"Wave is a completely free invoicing software with integrated accounting features. Perfect for startups and freelancers on a tight budget."},
  features:["Unbegrenzt","Buchhaltung","Bankverbindung"],
  pros:{de:["Komplett kostenlos", "Integrierte Buchhaltung", "Gute Grundfunktionen"], en:["Completely free", "Integrated accounting", "Good basic features"]},
  cons:{de:["Weniger Automatisierung", "Customer Support nur per Email"], en:["Less automation", "Customer support only via email"]},
  link:"https://waveapps.com/",
  badge:"popular",
  useCases:["basic","free"],
  votes:0,
  userVote:0
},
{
  id:3,
  name:"Bonsai",
  category:"all-in-one",
  price:"paid",
  priceDisplay:{de:"ab 17‚Ç¨/Monat", en:"from $17/month"},
  rating:4.9,
  description:{de:"All-in-One Suite mit Vertr√§gen, Angeboten & Rechnungen.", en:"All-in-One suite with contracts, proposals & invoices."},
  detailedDescription:{de:"Bonsai kombiniert Rechnungen, Vertr√§ge, Angebote und Zeiterfassung in einer Plattform. Speziell f√ºr Freelancer entwickelt, die alle Gesch√§ftsprozesse verwalten m√ºssen.", en:"Bonsai combines invoices, contracts, proposals and time tracking in one platform. Specifically developed for freelancers who need to manage all business processes."},
  features:["Vertr√§ge","Angebote","Steuern"],
  pros:{de:["Alles-in-einem Tool", "Automatische Zahlungserinnerungen", "Professionelle Vertragsvorlagen"], en:["All-in-one tool", "Automatic payment reminders", "Professional contract templates"]},
  cons:{de:["Etwas teurer", "Steuerfunktionen nur f√ºr USA/Kanada"], en:["Slightly more expensive", "Tax features only for USA/Canada"]},
  link:"https://hellobonsai.com/",
  badge:"popular",
  useCases:["contracts","automation","time-tracking"],
  votes:0,
  userVote:0
},
{
  id:4,
  name:"Zoho Invoice",
  category:"advanced",
  price:"freemium",
  priceDisplay:{de:"Kostenlos/Bezahlt", en:"Free/Paid"},
  rating:4.4,
  description:{de:"Beste internationale L√∂sung mit 100+ W√§hrungen.", en:"Best international solution with 100+ currencies."},
  detailedDescription:{de:"Zoho Invoice ist Teil der Zoho Suite und bietet exzellente internationale Funktionen. Unterst√ºtzt √ºber 100 W√§hrungen und ist in mehreren Sprachen verf√ºgbar.", en:"Zoho Invoice is part of the Zoho Suite and offers excellent international features. Supports over 100 currencies and is available in multiple languages."},
  features:["100+ W√§hrungen","Mehrsprachig","Steuer-Konform"],
  pros:{de:["Exzellente internationale Unterst√ºtzung", "Gute Integration in Zoho-√ñkosystem", "Flexible Preismodelle"], en:["Excellent international support", "Good integration with Zoho ecosystem", "Flexible pricing models"]},
  cons:{de:["Komplexere Einrichtung", "Mobil-Apps weniger intuitiv"], en:["More complex setup", "Mobile apps less intuitive"]},
  link:"https://go.zoho.com/IB42",
  badge:"new",
  useCases:["international","automation"],
  votes:0,
  userVote:0
},
{
  id:5,
  name:"Invoyce",
  category:"mobile",
  price:"freemium",
  priceDisplay:{de:"~1% Transaktionsgeb√ºhr", en:"~1% transaction fee"},
  rating:4.7,
  description:{de:"Mobile-First KI Rechnungen mit Beleg-Scanning.", en:"Mobile-first AI invoices with receipt scanning."},
  detailedDescription:{de:"Invoyce ist eine mobile-first Rechnungssoftware mit KI-Funktionen. Scan Belege und erstelle automatisch Rechnungen. Ideal f√ºr unterwegs arbeitende Freelancer.", en:"Invoyce is a mobile-first invoicing software with AI features. Scan receipts and create invoices automatically. Ideal for freelancers working on the go."},
  features:["KI","Mobile","Offline"],
  pros:{de:["Beste Mobile Experience", "KI-gest√ºtzte Belegverarbeitung", "Schnelle Rechnungserstellung"], en:["Best mobile experience", "AI-powered receipt processing", "Fast invoice creation"]},
  cons:{de:["Web-Version weniger umfangreich", "Transaktionsgeb√ºhren f√ºr Zahlungen"], en:["Web version less comprehensive", "Transaction fees for payments"]},
  link:"https://invoyce.ai/",
  badge:"new",
  useCases:["mobile","automation"],
  votes:0,
  userVote:0
},
{
  id:6,
  name:"QuickBooks",
  category:"enterprise",
  price:"paid",
  priceDisplay:{de:"ab 25‚Ç¨/Monat", en:"from $25/month"},
  rating:4.7,
  description:{de:"Komplette Buchhaltung f√ºr wachsende Unternehmen.", en:"Complete accounting for growing businesses."},
  detailedDescription:{de:"QuickBooks ist eine umfassende Buchhaltungssoftware mit integrierten Rechnungsfunktionen. Ideal f√ºr Unternehmen, die Rechnungswesen und Buchhaltung kombinieren m√ºssen.", en:"QuickBooks is a comprehensive accounting software with integrated invoicing features. Ideal for businesses that need to combine invoicing and accounting."},
  features:["Buchhaltung","Steuern","Payroll"],
  pros:{de:["Sehr umfangreiche Buchhaltungsfunktionen", "Gute Steuer-Tools", "Skaliert mit Unternehmenswachstum"], en:["Very comprehensive accounting functions", "Good tax tools", "Scales with business growth"]},
  cons:{de:["√úberw√§ltigend f√ºr reine Rechnungsstellung", "Teuer f√ºr kleine Freelancer"], en:["Overwhelming for pure invoicing", "Expensive for small freelancers"]},
  link:"https://quickbooks.intuit.com/",
  badge:"popular",
  useCases:["advanced","international"],
  votes:0,
  userVote:0
},
{
  id:7,
  name:"Invoicer.ai",
  category:"basic",
  price:"freemium",
  priceDisplay:{de:"ab 9‚Ç¨/Monat", en:"from $9/month"},
  rating:4.6,
  description:{de:"Schnelle KI-Rechnungen in unter 30 Sekunden.", en:"Fast AI invoices in under 30 seconds."},
  detailedDescription:{de:"Invoicer.ai verwendet KI, um Rechnungen in Sekundenschnelle zu erstellen. Einfache Benutzeroberfl√§che und schnelle Erstellung von wiederkehrenden Rechnungen.", en:"Invoicer.ai uses AI to create invoices in seconds. Simple user interface and quick creation of recurring invoices."},
  features:["Schnell","KI Autocomplete","Batch"],
  pros:{de:["Extrem schnelle Rechnungserstellung", "KI-Vorschl√§ge sparen Zeit", "Einfache Bedienung"], en:["Extremely fast invoice creation", "AI suggestions save time", "Easy to use"]},
  cons:{de:["Begrenzte Anpassungsm√∂glichkeiten", "Keine integrierte Zeiterfassung"], en:["Limited customization options", "No integrated time tracking"]},
  link:"https://invoicer.ai/",
  badge:"new",
  useCases:["automation","basic"],
  votes:0,
  userVote:0
},
{
  id:8,
  name:"Billdu",
  category:"mobile",
  price:"freemium",
  priceDisplay:{de:"Kostenlos/ab 9‚Ç¨", en:"Free/from $9"},
  rating:4.3,
  description:{de:"Rechnungen & Angebote mit Online-Zahlungen.", en:"Invoices & quotes with online payments."},
  detailedDescription:{de:"Billdu bietet Rechnungen, Angebote und Online-Zahlungen in einer App. Gute Mobile-Apps und Offline-Funktionalit√§t.", en:"Billdu offers invoices, quotes and online payments in one app. Good mobile apps and offline functionality."},
  features:["Angebote","Zahlungen","Mobile"],
  pros:{de:["Integrierte Online-Zahlungen", "Gute Offline-Funktionalit√§t", "Angebotsfunktion inklusive"], en:["Integrated online payments", "Good offline functionality", "Quote feature included"]},
  cons:{de:["Design etwas veraltet", "Begrenzte Automatisierung"], en:["Design somewhat outdated", "Limited automation"]},
  link:"https://www.billdu.com/",
  badge:"free",
  useCases:["mobile","basic"],
  votes:0,
  userVote:0
},
{
  id:9,
  name:"Pancake",
  category:"basic",
  price:"one-time",
  priceDisplay:{de:"Einmalzahlung 99‚Ç¨", en:"One-time $99"},
  rating:4.4,
  description:{de:"Self-hosted L√∂sung f√ºr volle Kontrolle.", en:"Self-hosted solution for full control."},
  detailedDescription:{de:"Pancake ist eine Self-Hosted Rechnungssoftware, die du auf deinem eigenen Server installierst. Einmalige Zahlung, lebenslange Updates. Volle Kontrolle √ºber deine Daten.", en:"Pancake is a self-hosted invoicing software that you install on your own server. One-time payment, lifetime updates. Full control over your data."},
  features:["Self-hosted","Lifetime","Kontrolle"],
  pros:{de:["Einmalige Zahlung, keine monatlichen Kosten", "Volle Datenkontrolle", "Anpassbar an eigene Bed√ºrfnisse"], en:["One-time payment, no monthly costs", "Full data control", "Customizable to own needs"]},
  cons:{de:["Selbst gehostet = eigene Wartung n√∂tig", "Kein automatisches Backup", "Keine Mobile Apps"], en:["Self-hosted = own maintenance required", "No automatic backup", "No mobile apps"]},
  link:"https://pancakeapp.com/",
  badge:"free",
  useCases:["basic"],
  votes:0,
  userVote:0
},
{
  id:10,
  name:"Harvest",
  category:"advanced",
  price:"freemium",
  priceDisplay:{de:"ab 12‚Ç¨/Monat", en:"from $12/month"},
  rating:4.5,
  description:{de:"Zeiterfassung & Rechnungen kombiniert.", en:"Time tracking & invoices combined."},
  detailedDescription:{de:"Harvest kombiniert Zeiterfassung und Rechnungsstellung nahtlos. Ideal f√ºr Freelancer, die nach Stunden abrechnen und Zeit direkt in Rechnungen umwandeln m√∂chten.", en:"Harvest seamlessly combines time tracking and invoicing. Ideal for freelancers who bill by the hour and want to convert time directly into invoices."},
  features:["Zeiterfassung","Projekte","Berichte"],
  pros:{de:["Perfekte Zeit-Rechnung-Integration", "Exzellente Berichte", "Einfache Bedienung"], en:["Perfect time-invoice integration", "Excellent reports", "Easy to use"]},
  cons:{de:["Teurer f√ºr Teams", "Begrenzte Rechnungsvorlagen"], en:["More expensive for teams", "Limited invoice templates"]},
  link:"https://www.getharvest.com/",
  badge:"popular",
  useCases:["time-tracking","automation"],
  votes:0,
  userVote:0
},
{
  id:11,
  name:"Debitoor",
  category:"basic",
  price:"freemium",
  priceDisplay:{de:"Kostenlos/ab 9‚Ç¨", en:"Free/from $9"},
  rating:4.2,
  description:{de:"Einfache L√∂sung f√ºr deutsche Freelancer.", en:"Simple solution for German freelancers."},
  detailedDescription:{de:"Debitoor ist eine einfache Rechnungssoftware speziell f√ºr den deutschen Markt. Enth√§lt deutsche Steuerformulare und ist auf Kleinunternehmer ausgelegt.", en:"Debitoor is a simple invoicing software specifically for the German market. Includes German tax forms and is designed for small businesses."},
  features:["Deutsch","Einfach","Umsatzsteuer"],
  pros:{de:["Optimiert f√ºr deutschen Markt", "Einfache Bedienung", "Guter Kundensupport auf Deutsch"], en:["Optimized for German market", "Easy to use", "Good customer support in German"]},
  cons:{de:["Weniger internationale Funktionen", "Design nicht modern"], en:["Fewer international features", "Design not modern"]},
  link:"https://debitoor.de/",
  badge:"free",
  useCases:["basic"],
  votes:0,
  userVote:0
},
{
  id:12,
  name:"FastBill",
  category:"advanced",
  price:"paid",
  priceDisplay:{de:"ab 9‚Ç¨/Monat", en:"from $9/month"},
  rating:4.3,
  description:{de:"Deutsche L√∂sung mit DATEV Integration.", en:"German solution with DATEV integration."},
  detailedDescription:{de:"FastBill ist eine deutsche Rechnungssoftware mit DATEV-Integration. Ideal f√ºr Freelancer, die mit Steuerberatern zusammenarbeiten.", en:"FastBill is a German invoicing software with DATEV integration. Ideal for freelancers who work with tax advisors."},
  features:["DATEV","Deutsch","Automatisch"],
  pros:{de:["DATEV-Integration f√ºr Steuerberater", "Gute Automatisierungsfunktionen", "Deutsche Compliance"], en:["DATEV integration for tax advisors", "Good automation features", "German compliance"]},
  cons:{de:["Komplexere Bedienung", "Teurer f√ºr umfangreiche Funktionen"], en:["More complex operation", "More expensive for extensive features"]},
  link:"https://www.fastbill.com/",
  badge:"popular",
  useCases:["automation","advanced"],
  votes:0,
  userVote:0
},
{
  id:13,
  name:"And Co",
  category:"all-in-one",
  price:"freemium",
  priceDisplay:{de:"Kostenlos/Bezahlt", en:"Free/Paid"},
  rating:4.6,
  description:{de:"Von Fiverr: Alles f√ºr Freelancer in einer App.", en:"By Fiverr: Everything for freelancers in one app."},
  detailedDescription:{de:"And Co (von Fiverr) kombiniert Rechnungen, Vertr√§ge, Zeiterfassung und Projektmanagement. Speziell f√ºr Freelancer-Plattformen optimiert.", en:"And Co (by Fiverr) combines invoices, contracts, time tracking and project management. Optimized specifically for freelancer platforms."},
  features:["Proposals","Contracts","Time"],
  pros:{de:["Perfekt f√ºr Fiverr-Freelancer", "All-in-One L√∂sung", "Gute Integrationen"], en:["Perfect for Fiverr freelancers", "All-in-one solution", "Good integrations"]},
  cons:{de:["Kostenpflichtige Features n√∂tig f√ºr volle Funktionalit√§t", "Weniger flexibel f√ºr Nicht-Fiverr-Nutzer"], en:["Paid features needed for full functionality", "Less flexible for non-Fiverr users"]},
  link:"https://www.and.co/",
  badge:"new",
  useCases:["contracts","time-tracking","automation"],
  votes:0,
  userVote:0
},
{
  id:14,
  name:"PandaDoc",
  category:"all-in-one",
  price:"paid",
  priceDisplay:{de:"ab 19‚Ç¨/Monat", en:"from $19/month"},
  rating:4.5,
  description:{de:"Dokumente, Vertr√§ge & eSignatures mit Tracking.", en:"Documents, contracts & eSignatures with tracking."},
  detailedDescription:{de:"PandaDoc fokussiert sich auf dokumentenbasierte Workflows mit eSignatures. Ideal f√ºr Unternehmen, die Vertr√§ge und Rechnungen mit Unterschriften kombinieren.", en:"PandaDoc focuses on document-based workflows with eSignatures. Ideal for businesses that combine contracts and invoices with signatures."},
  features:["Dokumente","eSign","Tracking"],
  pros:{de:["Exzellente eSignature-Funktionen", "Dokumenten-Tracking", "Professionelle Vorlagen"], en:["Excellent eSignature features", "Document tracking", "Professional templates"]},
  cons:{de:["Teurer f√ºr kleine Teams", "Steile Lernkurve"], en:["Expensive for small teams", "Steep learning curve"]},
  link:"https://www.pandadoc.com/",
  badge:"popular",
  useCases:["contracts","automation"],
  votes:0,
  userVote:0
},
{
  id:15,
  name:"Xero",
  category:"enterprise",
  price:"paid",
  priceDisplay:{de:"ab 12‚Ç¨/Monat", en:"from $12/month"},
  rating:4.6,
  description:{de:"Cloud-Buchhaltung f√ºr kleine Unternehmen.", en:"Cloud accounting for small businesses."},
  detailedDescription:{de:"Xero ist eine Cloud-Buchhaltungssoftware mit starken Rechnungsfunktionen. Besonders beliebt bei kleinen Unternehmen und Startups.", en:"Xero is a cloud accounting software with strong invoicing features. Particularly popular with small businesses and startups."},
  features:["Banking","Payroll","Reports"],
  pros:{de:["Exzellente Buchhaltungsfunktionen", "Gute Bankintegration", "Starke Berichte"], en:["Excellent accounting functions", "Good bank integration", "Strong reports"]},
  cons:{de:["F√ºr reine Rechnungsstellung √ºberdimensioniert", "Komplexe Einrichtung"], en:["Overkill for pure invoicing", "Complex setup"]},
  link:"https://www.xero.com/",
  badge:"popular",
  useCases:["advanced","international"],
  votes:0,
  userVote:0
},
{
  id:16,
  name:"SlimInvoice",
  category:"basic",
  price:"freemium",
  priceDisplay:{de:"Kostenlos/ab 5‚Ç¨", en:"Free/from $5"},
  rating:4.1,
  description:{de:"Minimalistische Rechnungen mit KI-Vorschl√§gen.", en:"Minimalist invoices with AI suggestions."},
  detailedDescription:{de:"SlimInvoice ist eine minimalistische Rechnungssoftware mit KI-Unterst√ºtzung. Fokussiert auf das Wesentliche ohne √ºberfl√ºssige Funktionen.", en:"SlimInvoice is a minimalist invoicing software with AI support. Focused on the essentials without unnecessary features."},
  features:["Minimal","KI","Schnell"],
  pros:{de:["Sehr einfache Bedienung", "Schnelle Rechnungserstellung", "G√ºnstige Preise"], en:["Very easy to use", "Fast invoice creation", "Low prices"]},
  cons:{de:["Sehr begrenzte Funktionen", "Keine Mobile Apps", "Weniger professionelle Vorlagen"], en:["Very limited features", "No mobile apps", "Less professional templates"]},
  link:"https://slimvoice.co/",
  badge:"free",
  useCases:["basic","automation"],
  votes:0,
  userVote:0
}
];

// Shared Data
let forumDiscussions = [];
let toolComments = {};
let userLikes = {};
let userId = '';
let username = '';

// App State
let lang = 'de';
let cat = 'all';
let price = 'all';
let sort = 'votes';
let query = '';
let activeUseCase = '';
let forumFilter = 'all';
let searchTimeout;
let lastVotedToolId = null;
let oldPositions = {};
let openDiscussions = {};

// Translations
const translations = {
  de: {
    badge: n => `üöÄ ${n} Rechnungs-Tools f√ºr 2026`,
    title: "Finde sofort dein perfektes Rechnungs-Tool",
    desc: "Echte Freelancer-Bewertungen, Top 5 Charts, intelligente Empfehlungen. Kein unn√∂tiges Scrollen.",
    searchPlaceholder: "Was m√∂chtest du mit deiner Rechnungssoftware erreichen?",
    searchTipsLabel: "Suche nach:",
    searchTips: ["kostenlos", "KI", "mobile", "Zeiterfassung", "international", "Automatisierung", "Vertr√§ge", "einfach"],
    navAuto: "Automatisierung",
    navAutoDesc: "Automatische Erinnerungen, wiederkehrende Rechnungen",
    navTime: "Zeiterfassung",
    navTimeDesc: "Zeit tracken & direkt in Rechnungen umwandeln",
    navIntl: "International",
    navIntlDesc: "Mehrere W√§hrungen, internationale Steuern",
    navMobile: "Mobile First",
    navMobileDesc: "Rechnungen unterwegs erstellen",
    navContract: "Vertr√§ge",
    navContractDesc: "Vertr√§ge & Rechnungen kombinieren",
    navFree: "Kostenlos",
    navFreeDesc: "Top kostenlose Rechnungs-Tools",
    topChartsTitle: "Top 5 Rechnungs-Tools - Community Ranking",
    catAll: "Alle",
    catBasic: "Basic",
    catAdvanced: "Advanced",
    catMobile: "Mobile",
    catAllInOne: "All-in-One",
    catEnterprise: "Enterprise",
    priceAll: "üí∞ Alle Preise",
    priceFree: "üÜì Kostenlos",
    pricePaid: "üí≥ Bezahlt",
    priceFreemium: "‚≠ê Freemium",
    priceOneTime: "üíé Einmalzahlung",
    sortPopular: "üî• Beliebt",
    sortVotes: "üëç Community",
    sortRating: "‚≠ê Bewertung",
    sortPriceLow: "üí∞ Preis ‚Üë",
    sortPriceHigh: "üí∞ Preis ‚Üì",
    toolsFound: "Tools",
    tryNow: "Testen",
    noTitle: "Keine Tools gefunden",
    noMsg: "√Ñndere deine Filter oder versuche andere Suchbegriffe.",
    resetBtn: "Filter zur√ºcksetzen",
    footerCopy: "¬© 2026 Invoice Finder | Community-gest√ºtzte Rechnungs-Tool Empfehlungen",
    footerDiscl: "Bewertungen basieren auf User-Feedback (Supabase). Alle Daten werden mit allen Nutzern geteilt.",
    helpful: "Hilfreich",
    pros: "Vorteile: ",
    cons: "Nachteile: ",
    forumTitle: "Community Forum",
    forumDiscussionsText: "Diskussionen",
    forumActiveText: "aktive Nutzer",
    forumTabAll: "Alle Diskussionen",
    forumTabPopular: "Beliebt",
    forumTabRecent: "Neueste",
    forumTabQuestions: "Fragen",
    forumTabTips: "Tipps & Tricks",
    newDiscussionText: "Neue Diskussion starten",
    modalTitle: "Neue Diskussion starten",
    modalToolLabel: "Tool ausw√§hlen",
    modalSelectDefault: "-- Tool w√§hlen --",
    modalTitleLabel: "Titel der Diskussion",
    modalContentLabel: "Deine Frage oder Diskussion",
    modalSubmit: "Diskussion starten",
    forumLike: "Gef√§llt mir",
    forumComment: "Kommentieren",
    forumReply: "Antworten",
    forumReplyPlaceholder: "Schreibe eine Antwort...",
    forumPosted: "Gepostet",
    forumActiveDiscussion: "Aktive Diskussion",
    viewDiscussion: "Diskussion anzeigen",
    hideDiscussion: "Diskussion ausblenden",
    addComment: "Kommentar hinzuf√ºgen",
    commentPlaceholder: "Dein Kommentar...",
    submitComment: "Kommentar senden",
    commentSingular: "Kommentar",
    commentPlural: "Kommentare",
    noDiscussions: "Noch keine Diskussionen",
    beFirst: "Sei der Erste, der eine Diskussion startet!",
    startFirstDiscussion: "Erste Diskussion starten",
    refreshText: "Aktualisieren"
  },
  en: {
    badge: n => `üöÄ ${n} Invoicing Tools for 2026`,
    title: "Find your perfect invoicing tool instantly",
    desc: "Real freelancer ratings, Top 5 charts, smart recommendations. No unnecessary scrolling.",
    searchPlaceholder: "What do you want to achieve with your invoicing software?",
    searchTipsLabel: "Try:",
    searchTips: ["free", "AI", "mobile", "time tracking", "international", "automation", "contracts", "simple"],
    navAuto: "Automation",
    navAutoDesc: "Auto-reminders, recurring invoices",
    navTime: "Time Tracking",
    navTimeDesc: "Track time & convert to invoices",
    navIntl: "International",
    navIntlDesc: "Multiple currencies, international taxes",
    navMobile: "Mobile First",
    navMobileDesc: "Create invoices on the go",
    navContract: "Contracts",
    navContractDesc: "Combine contracts & invoices",
    navFree: "Free",
    navFreeDesc: "Top free invoicing tools",
    topChartsTitle: "Top 5 Invoicing Tools - Community Ranking",
    catAll: "All",
    catBasic: "Basic",
    catAdvanced: "Advanced",
    catMobile: "Mobile",
    catAllInOne: "All-in-One",
    catEnterprise: "Enterprise",
    priceAll: "üí∞ All prices",
    priceFree: "üÜì Free",
    pricePaid: "üí≥ Paid",
    priceFreemium: "‚≠ê Freemium",
    priceOneTime: "üíé One-time",
    sortPopular: "üî• Popular",
    sortVotes: "üëç Community",
    sortRating: "‚≠ê Rating",
    sortPriceLow: "üí∞ Price ‚Üë",
    sortPriceHigh: "üí∞ Price ‚Üì",
    toolsFound: "Tools",
    tryNow: "Try Now",
    noTitle: "No tools found",
    noMsg: "Change your filters or try different search terms.",
    resetBtn: "Reset filters",
    footerCopy: "¬© 2026 Invoice Finder | Community-driven invoicing tool recommendations",
    footerDiscl: "Ratings based on user feedback (Supabase). All data is shared across all users.",
    helpful: "Helpful",
    pros: "Pros: ",
    cons: "Cons: ",
    forumTitle: "Community Forum",
    forumDiscussionsText: "Discussions",
    forumActiveText: "active users",
    forumTabAll: "All Discussions",
    forumTabPopular: "Popular",
    forumTabRecent: "Recent",
    forumTabQuestions: "Questions",
    forumTabTips: "Tips & Tricks",
    newDiscussionText: "Start New Discussion",
    modalTitle: "Start New Discussion",
    modalToolLabel: "Select Tool",
    modalSelectDefault: "-- Select Tool --",
    modalTitleLabel: "Discussion Title",
    modalContentLabel: "Your Question or Discussion",
    modalSubmit: "Start Discussion",
    forumLike: "Like",
    forumComment: "Comment",
    forumReply: "Reply",
    forumReplyPlaceholder: "Write a reply...",
    forumPosted: "Posted",
    forumActiveDiscussion: "Active Discussion",
    viewDiscussion: "View Discussion",
    hideDiscussion: "Hide Discussion",
    addComment: "Add Comment",
    commentPlaceholder: "Your comment...",
    submitComment: "Submit Comment",
    commentSingular: "comment",
    commentPlural: "comments",
    noDiscussions: "No discussions yet",
    beFirst: "Be the first to start a discussion!",
    startFirstDiscussion: "Start First Discussion",
    refreshText: "Refresh"
  }
};

// Supabase Helper Functions
async function supabaseFetch(endpoint, options = {}) {
  const headers = {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
    'Content-Type': 'application/json',
    ...options.headers
  };
  
  try {
    const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}`, {
      ...options,
      headers
    });
    
    if (!response.ok) {
      throw new Error(`Supabase error: ${response.status}`);
    }
    
    if (response.status === 204) {
      return null;
    }
    
    return await response.json();
  } catch (error) {
    console.error('Supabase fetch error:', error);
    throw error;
  }
}

async function initializeUser() {
  // Generate or load user ID
  userId = localStorage.getItem('supabase_user_id');
  if (!userId) {
    userId = 'user_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('supabase_user_id', userId);
  }
  
  // Generate or load username
  username = localStorage.getItem('forumUsername');
  if (!username) {
    const adjectives = ["Clever", "Smart", "Creative", "Pro", "Fast", "Digital", "Tech", "Free"];
    const nouns = ["Freelancer", "Designer", "Dev", "Pro", "Guru", "Expert", "Master", "Wizard"];
    const randomAdj = adjectives[Math.floor(Math.random() * adjectives.length)];
    const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
    const randomNum = Math.floor(Math.random() * 99) + 1;
    username = `${randomAdj}${randomNoun}${randomNum}`;
    localStorage.setItem('forumUsername', username);
  }
  
  // Initialize tool votes in Supabase if not exists
  for (const tool of invoiceTools) {
    try {
      await supabaseFetch('tool_votes', {
        method: 'POST',
        body: JSON.stringify({
          tool_id: tool.id,
          upvotes: 0,
          downvotes: 0,
          total_votes: 0
        }),
        headers: { 'Prefer': 'resolution=merge-duplicates' }
      });
    } catch (error) {
      // Tool might already exist, ignore
    }
  }
}

async function loadAllData() {
  try {
    showNotification('Lade Daten von Supabase...', 'info');
    
    // Load tool votes
    const votesData = await supabaseFetch('tool_votes?select=*');
    if (votesData) {
      votesData.forEach(vote => {
        const tool = invoiceTools.find(t => t.id === vote.tool_id);
        if (tool) {
          tool.votes = vote.total_votes || 0;
        }
      });
    }
    
    // Load forum discussions
    const discussionsData = await supabaseFetch('forum_discussions?select=*&order=created_at.desc');
    if (discussionsData) {
      forumDiscussions = discussionsData.map(d => ({
        id: d.id,
        toolId: d.tool_id,
        toolName: d.tool_name,
        author: d.author,
        avatar: d.author?.substring(0, 2).toUpperCase() || '??',
        title: d.title,
        content: d.content,
        likes: d.likes || 0,
        comments: d.comments || 0,
        timestamp: d.created_at
      }));
    }
    
    // Load tool comments
    const commentsData = await supabaseFetch('tool_comments?select=*&order=created_at.desc');
    if (commentsData) {
      toolComments = {};
      commentsData.forEach(comment => {
        if (!toolComments[comment.tool_id]) {
          toolComments[comment.tool_id] = [];
        }
        toolComments[comment.tool_id].push({
          author: comment.author,
          text: comment.comment,
          timestamp: comment.created_at
        });
      });
    }
    
    // Load user likes
    const likesData = await supabaseFetch(`discussion_likes?select=*&author_id=eq.${userId}`);
    if (likesData) {
      likesData.forEach(like => {
        userLikes[like.discussion_id] = true;
      });
    }
    
    // Load local user votes for UI state
    const savedVotes = localStorage.getItem('invoiceToolsVotes');
    if (savedVotes) {
      const userVotes = JSON.parse(savedVotes);
      invoiceTools.forEach(tool => {
        if (userVotes[tool.id]) {
          tool.userVote = userVotes[tool.id].userVote || 0;
        }
      });
    }
    
    // Update status indicator
    updateStatusIndicator(true);
    showNotification('Daten erfolgreich geladen!', 'success');
  } catch (error) {
    console.error('Error loading data:', error);
    updateStatusIndicator(false);
    showNotification('Fehler beim Laden der Daten. Verwende lokale Daten.', 'error');
  }
}

// Notification System
function showNotification(message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
    <span>${message}</span>
    <button class="notification-close"><i class="fas fa-times"></i></button>
  `;
  
  document.body.appendChild(notification);
  
  // Add close event
  notification.querySelector('.notification-close').addEventListener('click', () => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  });
  
  // Auto remove after 5 seconds
  setTimeout(() => {
    if (notification.parentNode) {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }
  }, 5000);
}

function updateStatusIndicator(online) {
  let indicator = document.querySelector('.supabase-status');
  if (!indicator) {
    indicator = document.createElement('div');
    indicator.className = 'supabase-status';
    document.body.appendChild(indicator);
  }
  
  indicator.className = `supabase-status ${online ? 'online' : 'offline'}`;
  indicator.innerHTML = `
    <i class="fas fa-database"></i>
    <span>Supabase ${online ? 'Connected' : 'Offline'}</span>
  `;
}

// Initialize
document.addEventListener('DOMContentLoaded', async () => {
  await initializeUser();
  await loadAllData();
  setupEvents();
  updateLang();
  renderTopCharts();
  applyFilters();
  renderForum();
  renderSearchTips();
  setupSearchTipsScroll();
  
  // Auto-refresh every 30 seconds
  setInterval(async () => {
    await loadAllData();
    renderTopCharts();
    applyFilters();
    renderForum();
  }, 30000);
});

// Event Setup
function setupEvents() {
  // Language switch
  document.getElementById('langBtn').addEventListener('click', () => {
    lang = lang === 'de' ? 'en' : 'de';
    document.getElementById('langText').textContent = lang === 'de' ? 'EN' : 'DE';
    updateLang();
    renderTopCharts();
    applyFilters();
    renderForum();
    renderSearchTips();
  });

  // Search functionality
  const searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('input', e => {
    clearTimeout(searchTimeout);
    const v = e.target.value.toLowerCase();
    searchTimeout = setTimeout(() => {
      query = v;
      if (v.length > 1) showSuggestions(v);
      else hideSuggestions();
      applyFilters();
    }, 300);
  });
  searchInput.addEventListener('focus', () => {
    if (searchInput.value.length > 0) showSuggestions(searchInput.value);
  });
  searchInput.addEventListener('blur', () => {
    setTimeout(hideSuggestions, 200);
  });

  // Keyboard shortcuts
  document.addEventListener('keydown', e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      searchInput.focus();
    }
    if (e.key === 'Escape') {
      searchInput.value = '';
      query = '';
      hideSuggestions();
      applyFilters();
    }
  });

  // Quick navigation
  document.getElementById('quickNav').addEventListener('click', e => {
    const card = e.target.closest('.quick-card');
    if (!card) return;
    
    document.querySelectorAll('.quick-card').forEach(c => c.classList.remove('active'));
    card.classList.add('active');
    
    const category = card.dataset.category;
    const useCase = card.dataset.usecase;
    
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    document.querySelector('[data-scope="all"]').classList.add('active');
    
    if (category) {
      cat = 'all';
      price = category;
      activeUseCase = '';
      document.getElementById('priceFilter').value = price;
    } else if (useCase) {
      cat = 'all';
      price = 'all';
      activeUseCase = useCase;
      document.getElementById('priceFilter').value = price;
    }
    
    query = '';
    searchInput.value = '';
    
    applyFilters();
    window.scrollTo({ top: document.querySelector('.tools-container').offsetTop - 20, behavior: 'smooth' });
  });

  // Tool filters
  document.querySelector('.compact-filters').addEventListener('click', e => {
    const btn = e.target.closest('.filter-btn');
    if (!btn) return;
    
    document.querySelectorAll('.quick-card').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.compact-filters .filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    if (btn.dataset.scope === 'all') {
      cat = 'all';
    } else if (btn.dataset.category) {
      cat = btn.dataset.category;
    }
    
    price = 'all';
    activeUseCase = '';
    document.getElementById('priceFilter').value = price;
    
    applyFilters();
  });

  // Price and sort filters
  document.getElementById('priceFilter').addEventListener('change', function() {
    price = this.value;
    document.querySelectorAll('.quick-card').forEach(c => c.classList.remove('active'));
    activeUseCase = '';
    applyFilters();
  });
  
  document.getElementById('sortFilter').addEventListener('change', function() {
    sort = this.value;
    applyFilters();
  });

  // Forum tabs
  document.querySelector('.forum-tabs').addEventListener('click', e => {
    const tab = e.target.closest('.forum-tab');
    if (!tab) return;
    
    document.querySelectorAll('.forum-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    forumFilter = tab.dataset.forumFilter;
    renderForum();
  });

  // New discussion buttons
  document.getElementById('newDiscussionBtn').addEventListener('click', openForumModal);
  document.getElementById('newDiscussionBtn2')?.addEventListener('click', openForumModal);

  // Modal close
  document.getElementById('modalClose').addEventListener('click', () => {
    document.getElementById('forumModal').classList.remove('active');
  });

  // Forum form submission
  document.getElementById('forumForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const toolId = parseInt(document.getElementById('modalToolSelect').value);
    const title = document.getElementById('modalTitleInput').value.trim();
    const content = document.getElementById('modalContentInput').value.trim();
    
    if (!toolId || !title || !content) return;
    
    const tool = invoiceTools.find(t => t.id === toolId);
    if (!tool) return;
    
    try {
      const result = await supabaseFetch('forum_discussions', {
        method: 'POST',
        body: JSON.stringify({
          tool_id: toolId,
          tool_name: tool.name,
          author: username,
          author_id: userId,
          title: title,
          content: content,
          likes: 0,
          comments: 0
        })
      });
      
      if (result) {
        showNotification('Diskussion erfolgreich erstellt!', 'success');
        // Reset form and close modal
        this.reset();
        document.getElementById('forumModal').classList.remove('active');
        
        // Reload data
        await loadAllData();
        renderForum();
        
        // Scroll to forum section
        document.querySelector('.forum-section').scrollIntoView({ behavior: 'smooth' });
      }
    } catch (error) {
      showNotification('Fehler beim Erstellen der Diskussion', 'error');
    }
  });

  // Scroll to top button
  const scrollBtn = document.getElementById('scrollTop');
  window.addEventListener('scroll', () => {
    scrollBtn.classList.toggle('visible', window.pageYOffset > 300);
  });
  scrollBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Refresh data button
  document.getElementById('refreshDataBtn').addEventListener('click', async () => {
    const btn = document.getElementById('refreshDataBtn');
    btn.classList.add('data-refresh');
    
    await loadAllData();
    renderTopCharts();
    applyFilters();
    renderForum();
    
    setTimeout(() => {
      btn.classList.remove('data-refresh');
    }, 1000);
  });
}

// Voting System with Supabase
async function handleVote(toolId, vote) {
  const tool = invoiceTools.find(t => t.id === toolId);
  if (!tool) return;

  const oldUserVote = tool.userVote;
  
  if (tool.userVote === vote) {
    // Remove vote
    tool.userVote = 0;
  } else {
    // Add or change vote
    tool.userVote = vote;
  }
  
  // Save local user vote
  const savedVotes = JSON.parse(localStorage.getItem('invoiceToolsVotes') || '{}');
  savedVotes[toolId] = { userVote: tool.userVote };
  localStorage.setItem('invoiceToolsVotes', JSON.stringify(savedVotes));
  
  // Calculate vote changes for Supabase
  let upvoteChange = 0;
  let downvoteChange = 0;
  
  if (oldUserVote === 1 && vote === 1) {
    // Removing upvote
    upvoteChange = -1;
  } else if (oldUserVote === -1 && vote === -1) {
    // Removing downvote
    downvoteChange = -1;
  } else if (oldUserVote === 1 && vote === -1) {
    // Changing from upvote to downvote
    upvoteChange = -1;
    downvoteChange = 1;
  } else if (oldUserVote === -1 && vote === 1) {
    // Changing from downvote to upvote
    downvoteChange = -1;
    upvoteChange = 1;
  } else if (oldUserVote === 0 && vote === 1) {
    // New upvote
    upvoteChange = 1;
  } else if (oldUserVote === 0 && vote === -1) {
    // New downvote
    downvoteChange = 1;
  }
  
  // Update in Supabase
  try {
    const existingVote = await supabaseFetch(`tool_votes?tool_id=eq.${toolId}`);
    
    if (existingVote && existingVote[0]) {
      const updatedUpvotes = (existingVote[0].upvotes || 0) + upvoteChange;
      const updatedDownvotes = (existingVote[0].downvotes || 0) + downvoteChange;
      const updatedTotal = updatedUpvotes - updatedDownvotes;
      
      await supabaseFetch(`tool_votes?tool_id=eq.${toolId}`, {
        method: 'PATCH',
        body: JSON.stringify({
          upvotes: updatedUpvotes,
          downvotes: updatedDownvotes,
          total_votes: updatedTotal
        })
      });
      
      // Update local state
      tool.votes = updatedTotal;
      
      // UI Animation
      lastVotedToolId = toolId;
      renderTopCharts();
      applyFilters();
      
      showNotification('Dein Vote wurde gespeichert!', 'success');
    }
  } catch (error) {
    console.error('Error updating vote:', error);
    showNotification('Fehler beim Speichern des Votes', 'error');
  }
}

// Forum Likes with Supabase
async function handleForumLike(discussionId) {
  const discussion = forumDiscussions.find(d => d.id === discussionId);
  if (!discussion) return;
  
  const isLiked = userLikes[discussionId] === true;
  
  try {
    if (isLiked) {
      // Unlike
      await supabaseFetch(`discussion_likes?discussion_id=eq.${discussionId}&author_id=eq.${userId}`, {
        method: 'DELETE'
      });
      
      // Update discussion likes count
      await supabaseFetch(`forum_discussions?id=eq.${discussionId}`, {
        method: 'PATCH',
        body: JSON.stringify({ likes: discussion.likes - 1 })
      });
      
      userLikes[discussionId] = false;
      discussion.likes--;
    } else {
      // Like
      await supabaseFetch('discussion_likes', {
        method: 'POST',
        body: JSON.stringify({
          discussion_id: discussionId,
          author_id: userId
        })
      });
      
      // Update discussion likes count
      await supabaseFetch(`forum_discussions?id=eq.${discussionId}`, {
        method: 'PATCH',
        body: JSON.stringify({ likes: discussion.likes + 1 })
      });
      
      userLikes[discussionId] = true;
      discussion.likes++;
    }
    
    renderForum();
  } catch (error) {
    console.error('Error handling like:', error);
    showNotification('Fehler beim Speichern des Likes', 'error');
  }
}

// Tool Comments with Supabase
async function handleCommentSubmit(toolId, commentText) {
  if (!commentText.trim()) return;
  
  try {
    await supabaseFetch('tool_comments', {
      method: 'POST',
      body: JSON.stringify({
        tool_id: toolId,
        author: username,
        author_id: userId,
        comment: commentText
      })
    });
    
    showNotification('Kommentar erfolgreich gespeichert!', 'success');
    
    // Reload comments
    const commentsData = await supabaseFetch(`tool_comments?tool_id=eq.${toolId}&order=created_at.desc`);
    if (commentsData) {
      toolComments[toolId] = commentsData.map(comment => ({
        author: comment.author,
        text: comment.comment,
        timestamp: comment.created_at
      }));
    }
    
    applyFilters();
    return true;
  } catch (error) {
    console.error('Error submitting comment:', error);
    showNotification('Fehler beim Speichern des Kommentars', 'error');
    return false;
  }
}

// Rest of your existing functions (setupSearchTipsScroll, renderSearchTips, openForumModal, renderForum, getTimeAgo, showSuggestions, hideSuggestions, highlight, catIcon, catName, updateLang, renderTopCharts, calculateScore, applyFilters, renderTools, resetFilters) remain the same but use the updated data structures

function setupSearchTipsScroll() {
  const tipsContainer = document.getElementById('searchTips');
  const scrollLeftBtn = document.getElementById('scrollLeftBtn');
  const scrollRightBtn = document.getElementById('scrollRightBtn');
  
  function updateScrollButtons() {
    const container = document.querySelector('.search-tips-wrapper');
    const tips = document.getElementById('searchTips');
    
    const isOverflowing = tips.scrollWidth > container.clientWidth;
    
    if (isOverflowing) {
      scrollLeftBtn.classList.remove('hidden');
      scrollRightBtn.classList.remove('hidden');
    } else {
      scrollLeftBtn.classList.add('hidden');
      scrollRightBtn.classList.add('hidden');
    }
    
    if (tips.scrollLeft <= 0) {
      scrollLeftBtn.classList.add('hidden');
    } else {
      scrollLeftBtn.classList.remove('hidden');
    }
    
    if (tips.scrollLeft + tips.clientWidth >= tips.scrollWidth - 1) {
      scrollRightBtn.classList.add('hidden');
    } else {
      scrollRightBtn.classList.remove('hidden');
    }
  }
  
  scrollLeftBtn.addEventListener('click', () => {
    tipsContainer.scrollBy({ left: -100, behavior: 'smooth' });
  });
  
  scrollRightBtn.addEventListener('click', () => {
    tipsContainer.scrollBy({ left: 100, behavior: 'smooth' });
  });
  
  window.addEventListener('resize', updateScrollButtons);
  
  setTimeout(updateScrollButtons, 100);
  setTimeout(updateScrollButtons, 500);
}

function renderSearchTips() {
  const tipsContainer = document.getElementById('searchTips');
  const t = translations[lang];
  
  const label = tipsContainer.querySelector('.search-tips-label');
  tipsContainer.innerHTML = '';
  if (label) tipsContainer.appendChild(label);
  
  const tips = t.searchTips || [];
  
  tips.forEach(tip => {
    const tipElement = document.createElement('span');
    tipElement.className = 'search-tip-item';
    tipElement.textContent = tip;
    tipElement.addEventListener('click', () => {
      document.querySelectorAll('.search-tip-item').forEach(item => {
        item.classList.remove('active');
      });
      
      tipElement.classList.add('active');
      
      document.getElementById('searchInput').value = tip;
      query = tip.toLowerCase();
      applyFilters();
      
      const event = new Event('input', { bubbles: true });
      document.getElementById('searchInput').dispatchEvent(event);
      
      document.getElementById('searchInput').focus();
      
      setTimeout(() => {
        tipElement.classList.remove('active');
      }, 2000);
    });
    tipsContainer.appendChild(tipElement);
  });
  
  setTimeout(() => {
    setupSearchTipsScroll();
  }, 50);
}

function openForumModal() {
  const modal = document.getElementById('forumModal');
  const select = document.getElementById('modalToolSelect');
  
  select.innerHTML = '<option value="">' + translations[lang].modalSelectDefault + '</option>';
  
  invoiceTools.forEach(tool => {
    const option = document.createElement('option');
    option.value = tool.id;
    option.textContent = tool.name;
    select.appendChild(option);
  });
  
  modal.classList.add('active');
}

function renderForum() {
  const container = document.getElementById('forumContainer');
  const t = translations[lang];
  
  document.getElementById('forumDiscussionsCount').textContent = forumDiscussions.length;
  document.getElementById('forumActiveUsers').textContent = Math.min(forumDiscussions.length, 5);
  
  let filteredDiscussions = [...forumDiscussions];
  
  if (forumFilter === 'popular') {
    filteredDiscussions.sort((a, b) => b.likes - a.likes);
  } else if (forumFilter === 'recent') {
    filteredDiscussions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
  } else if (forumFilter === 'questions') {
    filteredDiscussions = filteredDiscussions.filter(d => 
      d.title.includes('?') || d.title.toLowerCase().includes('frage') || 
      d.title.toLowerCase().includes('question') || d.content.includes('?')
    );
  } else if (forumFilter === 'tips') {
    filteredDiscussions = filteredDiscussions.filter(d => 
      d.title.toLowerCase().includes('tipp') || d.title.toLowerCase().includes('tip') ||
      d.title.toLowerCase().includes('trick') || d.title.toLowerCase().includes('erfahrung')
    );
  }
  
  if (filteredDiscussions.length === 0) {
    container.innerHTML = `
      <div class="forum-card" style="text-align:center;padding:40px 20px;">
        <i class="fas fa-comments" style="font-size:3rem;color:var(--text-muted);opacity:0.5;margin-bottom:20px;"></i>
        <h3 style="margin-bottom:10px;color:var(--text-muted);">${t.noDiscussions}</h3>
        <p style="color:var(--text-muted);margin-bottom:20px;">${t.beFirst}</p>
        <button class="forum-new-post-btn" id="newDiscussionBtn2">
          <i class="fas fa-plus"></i>
          <span>${t.startFirstDiscussion}</span>
        </button>
      </div>
    `;
    
    document.getElementById('newDiscussionBtn2')?.addEventListener('click', openForumModal);
    return;
  }
  
  container.innerHTML = filteredDiscussions.map(discussion => {
    const timeAgo = getTimeAgo(discussion.timestamp);
    const isLiked = userLikes[discussion.id] === true;
    
    return `
      <div class="forum-card" data-discussion-id="${discussion.id}">
        <div class="forum-card-header">
          <div class="forum-author">
            <div class="forum-avatar">${discussion.avatar}</div>
            <div class="forum-author-info">
              <div class="forum-author-name">${discussion.author}</div>
              <div class="forum-time">${t.forumPosted} ${timeAgo}</div>
            </div>
          </div>
          <div class="forum-tool-badge">${discussion.toolName}</div>
        </div>
        <div class="forum-content">
          <h3 style="margin-bottom:10px;font-size:1.1rem;">${discussion.title}</h3>
          <p>${discussion.content}</p>
        </div>
        <div class="forum-actions">
          <button class="forum-action-btn like-btn ${isLiked ? 'liked' : ''}" data-id="${discussion.id}">
            <i class="fas fa-heart"></i>
            <span class="like-count">${discussion.likes}</span>
            <span>${t.forumLike}</span>
          </button>
          <button class="forum-action-btn comment-btn" data-id="${discussion.id}">
            <i class="fas fa-comment"></i>
            <span>${discussion.comments}</span>
            <span>${t.forumComment}</span>
          </button>
        </div>
      </div>
    `;
  }).join('');
  
  container.querySelectorAll('.like-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const discussionId = parseInt(this.dataset.id);
      handleForumLike(discussionId);
    });
  });
}

function getTimeAgo(timestamp) {
  const now = new Date();
  const past = new Date(timestamp);
  const diffMs = now - past;
  const diffMins = Math.floor(diffMs / 60000);
  const diffHours = Math.floor(diffMs / 3600000);
  const diffDays = Math.floor(diffMs / 86400000);
  
  if (lang === 'de') {
    if (diffMins < 1) return 'gerade eben';
    if (diffMins < 60) return `vor ${diffMins} Minuten`;
    if (diffHours < 24) return `vor ${diffHours} Stunden`;
    if (diffDays === 1) return 'gestern';
    if (diffDays < 7) return `vor ${diffDays} Tagen`;
    return `am ${past.toLocaleDateString('de-DE')}`;
  } else {
    if (diffMins < 1) return 'just now';
    if (diffMins < 60) return `${diffMins} minutes ago`;
    if (diffHours < 24) return `${diffHours} hours ago`;
    if (diffDays === 1) return 'yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    return `on ${past.toLocaleDateString('en-US')}`;
  }
}

function showSuggestions(q) {
  const div = document.getElementById('searchSuggestions');
  const matches = invoiceTools.filter(t => {
    const txt = `${t.name} ${t.category} ${t.description[lang]} ${t.features.join(' ')}`.toLowerCase();
    return txt.includes(q);
  }).slice(0, 6);
  
  if (matches.length > 0) {
    div.innerHTML = matches.map(t => `
      <div class="suggestion-item" data-tool="${t.id}">
        <i class="${catIcon(t.category)} suggestion-icon"></i>
        <div class="suggestion-text">
          <div class="suggestion-name">${highlight(t.name, q)}</div>
          <div class="suggestion-meta">${catName(t.category)} ‚Ä¢ ${t.priceDisplay[lang]}</div>
        </div>
      </div>
    `).join('');
    
    div.querySelectorAll('.suggestion-item').forEach(el => {
      el.addEventListener('click', () => {
        const toolId = parseInt(el.dataset.tool);
        const tool = invoiceTools.find(t => t.id === toolId);
        if (tool) {
          document.getElementById('searchInput').value = tool.name;
          query = tool.name.toLowerCase();
          hideSuggestions();
          applyFilters();
          setTimeout(() => {
            const toolElement = document.querySelector(`[data-id="${toolId}"]`);
            if (toolElement) {
              toolElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
              toolElement.style.boxShadow = '0 0 0 2px var(--primary)';
              setTimeout(() => toolElement.style.boxShadow = '', 2000);
            }
          }, 100);
        }
      });
    });
    div.classList.add('active');
  } else {
    hideSuggestions();
  }
}

function hideSuggestions() {
  document.getElementById('searchSuggestions').classList.remove('active');
}

function highlight(txt, q) {
  const rx = new RegExp(`(${q})`, 'gi');
  return txt.replace(rx, '<span style="color:var(--primary-light)">$1</span>');
}

function catIcon(c) {
  const m = {
    basic: 'fas fa-file-invoice',
    advanced: 'fas fa-chart-line',
    mobile: 'fas fa-mobile-alt',
    'all-in-one': 'fas fa-box',
    enterprise: 'fas fa-building'
  };
  return m[c] || 'fas fa-star';
}

function catName(c) {
  const m = {
    basic: translations[lang].catBasic,
    advanced: translations[lang].catAdvanced,
    mobile: translations[lang].catMobile,
    'all-in-one': translations[lang].catAllInOne,
    enterprise: translations[lang].catEnterprise
  };
  return m[c] || c;
}

function updateLang() {
  const t = translations[lang];
  document.getElementById('badgeText').textContent = t.badge(invoiceTools.length);
  document.getElementById('pageTitle').textContent = t.title;
  document.getElementById('pageDescription').textContent = t.desc;
  document.getElementById('searchInput').placeholder = t.searchPlaceholder;
  document.getElementById('searchTipsLabel').textContent = t.searchTipsLabel;
  document.getElementById('navAuto').textContent = t.navAuto;
  document.getElementById('navAutoDesc').textContent = t.navAutoDesc;
  document.getElementById('navTime').textContent = t.navTime;
  document.getElementById('navTimeDesc').textContent = t.navTimeDesc;
  document.getElementById('navIntl').textContent = t.navIntl;
  document.getElementById('navIntlDesc').textContent = t.navIntlDesc;
  document.getElementById('navMobile').textContent = t.navMobile;
  document.getElementById('navMobileDesc').textContent = t.navMobileDesc;
  document.getElementById('navContract').textContent = t.navContract;
  document.getElementById('navContractDesc').textContent = t.navContractDesc;
  document.getElementById('navFree').textContent = t.navFree;
  document.getElementById('navFreeDesc').textContent = t.navFreeDesc;
  document.getElementById('topChartsTitle').textContent = t.topChartsTitle;
  document.getElementById('catAll').textContent = t.catAll;
  document.getElementById('catBasic').textContent = t.catBasic;
  document.getElementById('catAdvanced').textContent = t.catAdvanced;
  document.getElementById('catMobile').textContent = t.catMobile;
  document.getElementById('catAllInOne').textContent = t.catAllInOne;
  document.getElementById('catEnterprise').textContent = t.catEnterprise;
  document.getElementById('toolsText').textContent = t.toolsFound;
  document.getElementById('footerCopy').textContent = t.footerCopy;
  document.getElementById('footerDiscl').textContent = t.footerDiscl;
  document.getElementById('refreshText').textContent = t.refreshText;

  const pf = document.getElementById('priceFilter');
  pf.innerHTML = `
    <option value="all">${t.priceAll}</option>
    <option value="free">${t.priceFree}</option>
    <option value="paid">${t.pricePaid}</option>
    <option value="freemium">${t.priceFreemium}</option>
    <option value="one-time">${t.priceOneTime}</option>
  `;
  pf.value = price;

  const sf = document.getElementById('sortFilter');
  sf.innerHTML = `
    <option value="votes">${t.sortVotes}</option>
    <option value="popular">${t.sortPopular}</option>
    <option value="rating">${t.sortRating}</option>
    <option value="price-low">${t.sortPriceLow}</option>
    <option value="price-high">${t.sortPriceHigh}</option>
  `;
  sf.value = sort;
  
  document.getElementById('forumTitle').textContent = t.forumTitle;
  document.getElementById('forumDiscussionsText').textContent = t.forumDiscussionsText;
  document.getElementById('forumActiveText').textContent = t.forumActiveText;
  document.getElementById('forumTabAll').textContent = t.forumTabAll;
  document.getElementById('forumTabPopular').textContent = t.forumTabPopular;
  document.getElementById('forumTabRecent').textContent = t.forumTabRecent;
  document.getElementById('forumTabQuestions').textContent = t.forumTabQuestions;
  document.getElementById('forumTabTips').textContent = t.forumTabTips;
  document.getElementById('newDiscussionText').textContent = t.newDiscussionText;
  document.getElementById('modalTitle').textContent = t.modalTitle;
  document.getElementById('modalToolLabel').textContent = t.modalToolLabel;
  document.getElementById('modalSelectDefault').textContent = t.modalSelectDefault;
  document.getElementById('modalTitleLabel').textContent = t.modalTitleLabel;
  document.getElementById('modalContentLabel').textContent = t.modalContentLabel;
  document.getElementById('modalSubmit').textContent = t.modalSubmit;
}

function renderTopCharts() {
  const container = document.getElementById('topCharts');
  
  const oldTopTools = [...invoiceTools]
    .sort((a, b) => calculateScore(b) - calculateScore(a))
    .slice(0, 5);
  
  oldPositions = {};
  oldTopTools.forEach((tool, index) => {
    oldPositions[tool.id] = index + 1;
  });
  
  const sortedTools = [...invoiceTools]
    .sort((a, b) => calculateScore(b) - calculateScore(a))
    .slice(0, 5);

  container.innerHTML = sortedTools.map((tool, index) => {
    const newPosition = index + 1;
    const oldPosition = oldPositions[tool.id];
    let positionClass = '';
    
    if (lastVotedToolId === tool.id) {
      if (oldPosition && newPosition < oldPosition) {
        positionClass = 'moving-up';
      } else if (oldPosition && newPosition > oldPosition) {
        positionClass = 'moving-down';
      }
    }
    
    return `
    <div class="chart-card ${positionClass}" data-id="${tool.id}">
      <div class="chart-header">
        <div class="chart-rank rank-${newPosition} ${positionClass}">${newPosition}</div>
        <div class="chart-votes">
          <i class="fas fa-thumbs-up"></i>
          <span class="vote-count-display">${tool.votes}</span>
        </div>
      </div>
      <div class="chart-tool-name">${tool.name}</div>
      <div class="chart-category">${catName(tool.category)}</div>
      <div class="chart-price">${tool.priceDisplay[lang]}</div>
      <div class="chart-description">${tool.detailedDescription ? tool.detailedDescription[lang] : tool.description[lang]}</div>
      ${tool.pros ? `
      <div class="chart-pros-cons">
        <div class="pros-list"><strong>${translations[lang].pros}</strong> ${tool.pros[lang].slice(0,2).join(', ')}</div>
        <div class="cons-list"><strong>${translations[lang].cons}</strong> ${tool.cons[lang].slice(0,1).join(', ')}</div>
      </div>
      ` : ''}
      <div class="chart-actions">
        <button class="vote-btn up ${tool.userVote === 1 ? 'active' : ''}" data-id="${tool.id}" data-vote="1">
          <i class="fas fa-thumbs-up"></i> ${translations[lang].helpful}
        </button>
        <button class="vote-btn down ${tool.userVote === -1 ? 'active' : ''}" data-id="${tool.id}" data-vote="-1">
          <i class="fas fa-thumbs-down"></i>
        </button>
      </div>
    </div>
  `}).join('');

  setTimeout(() => {
    container.querySelectorAll('.chart-card.moving-up, .chart-card.moving-down').forEach(card => {
      card.classList.remove('moving-up', 'moving-down');
    });
    container.querySelectorAll('.chart-rank.moving-up, .chart-rank.moving-down').forEach(rank => {
      rank.classList.remove('moving-up', 'moving-down');
    });
  }, 1500);

  container.querySelectorAll('.vote-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const toolId = parseInt(btn.dataset.id);
      const vote = parseInt(btn.dataset.vote);
      handleVote(toolId, vote);
    });
  });
}

function calculateScore(tool) {
  return tool.votes + tool.rating * 10;
}

function applyFilters() {
  let filtered = invoiceTools.filter(tool => {
    if (cat !== 'all' && tool.category !== cat) return false;
    if (price !== 'all' && tool.price !== price) return false;
    
    if (activeUseCase && (!tool.useCases || !tool.useCases.includes(activeUseCase))) {
      return false;
    }
    
    if (query) {
      const txt = `${tool.name} ${tool.category} ${tool.description[lang]} ${tool.features.join(' ')}`.toLowerCase();
      if (!txt.includes(query)) return false;
    }
    return true;
  });

  filtered.sort((a, b) => {
    if (sort === 'rating') return b.rating - a.rating;
    if (sort === 'votes') return calculateScore(b) - calculateScore(a);
    if (sort === 'popular') return (b.badge === 'popular' ? 1 : 0) - (a.badge === 'popular' ? 1 : 0);
    if (sort === 'price-low' || sort === 'price-high') {
      const aPrice = a.priceDisplay[lang].includes('Free') || a.priceDisplay[lang].includes('Kostenlos') ? 0 : 
                    parseFloat(a.priceDisplay[lang].replace(/[^\d.]/g, '')) || 999;
      const bPrice = b.priceDisplay[lang].includes('Free') || b.priceDisplay[lang].includes('Kostenlos') ? 0 : 
                    parseFloat(b.priceDisplay[lang].replace(/[^\d.]/g, '')) || 999;
      return sort === 'price-low' ? aPrice - bPrice : bPrice - aPrice;
    }
    return 0;
  });

  renderTools(filtered);
}

function renderTools(tools) {
  const grid = document.getElementById('toolsGrid');
  const t = translations[lang];
  document.getElementById('toolCount').textContent = tools.length;

  if (tools.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-search"></i>
        <h3>${t.noTitle}</h3>
        <p>${t.noMsg}</p>
        <button class="reset-btn" id="resetFiltersBtn">
          <i class="fas fa-redo"></i> ${t.resetBtn}
        </button>
      </div>
    `;
    document.getElementById('resetFiltersBtn').addEventListener('click', resetFilters);
    return;
  }

  grid.innerHTML = tools.map(tool => {
    const comments = toolComments[tool.id] || [];
    const isDiscussionOpen = openDiscussions[tool.id] === true;
    const commentText = comments.length === 1 ? t.commentSingular : t.commentPlural;
    
    return `
      <div class="compact-tool-row" data-id="${tool.id}">
        <div class="tool-vote-compact">
          <div class="vote-count ${tool.userVote === 1 ? 'upvoted' : tool.userVote === -1 ? 'downvoted' : ''}">${tool.votes}</div>
          <div>
            <button class="vote-btn-compact up ${tool.userVote === 1 ? 'active' : ''}" data-id="${tool.id}" data-vote="1">
              <i class="fas fa-thumbs-up"></i>
            </button>
            <button class="vote-btn-compact down ${tool.userVote === -1 ? 'active' : ''}" data-id="${tool.id}" data-vote="-1">
              <i class="fas fa-thumbs-down"></i>
            </button>
          </div>
        </div>
        <div class="tool-info-compact">
          <div class="tool-name-row">
            <div class="tool-name-compact">${tool.name}</div>
            <div class="tool-category-compact">${catName(tool.category)}</div>
          </div>
          <div class="tool-desc-compact">${tool.detailedDescription ? tool.detailedDescription[lang] : tool.description[lang]}</div>
          ${tool.pros ? `
          <div class="tool-pros-cons-compact">
            <span class="pros">${t.pros}</span>${tool.pros[lang].slice(0,2).join(', ')} 
            <span class="cons">${t.cons}</span>${tool.cons[lang].slice(0,1).join(', ')}
          </div>
          ` : ''}
        </div>
        <div class="tool-meta-compact">
          <div class="tool-price-compact">${tool.priceDisplay[lang]}</div>
          <a href="${tool.link}" class="tool-link-compact" target="_blank" rel="noopener noreferrer">${t.tryNow}</a>
        </div>
        ${comments.length > 0 ? `
        <div class="tool-discussion-panel ${isDiscussionOpen ? 'active' : ''}">
          <div class="discussion-header">
            <div class="discussion-count">
              <i class="fas fa-comment"></i>
              <span>${comments.length} ${commentText}</span>
            </div>
          </div>
          <div class="discussion-content">
            ${comments.map(comment => `
              <div class="discussion-item">
                <div class="discussion-item-header">
                  <div class="discussion-author">${comment.author}</div>
                  <div class="discussion-time">${comment.timestamp}</div>
                </div>
                <div class="discussion-text">${comment.text}</div>
              </div>
            `).join('')}
          </div>
          <div class="discussion-form">
            <input type="text" class="discussion-input" placeholder="${t.commentPlaceholder}" id="comment-input-${tool.id}">
            <button class="discussion-submit-btn" data-id="${tool.id}">${t.submitComment}</button>
          </div>
        </div>
        <button class="discussion-toggle-btn ${isDiscussionOpen ? 'active' : ''}" data-id="${tool.id}">
          <i class="fas fa-comment${isDiscussionOpen ? '-slash' : ''}"></i>
          <span>${isDiscussionOpen ? t.hideDiscussion : t.viewDiscussion}</span>
          <span>(${comments.length})</span>
        </button>
        ` : ''}
      </div>
    `;
  }).join('');

  grid.querySelectorAll('.vote-btn-compact').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const toolId = parseInt(btn.dataset.id);
      const vote = parseInt(btn.dataset.vote);
      handleVote(toolId, vote);
    });
  });
  
  grid.querySelectorAll('.discussion-toggle-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const toolId = parseInt(this.dataset.id);
      openDiscussions[toolId] = !openDiscussions[toolId];
      applyFilters();
    });
  });
  
  grid.querySelectorAll('.discussion-submit-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
      const toolId = parseInt(this.dataset.id);
      const input = document.getElementById(`comment-input-${toolId}`);
      const commentText = input.value.trim();
      
      if (commentText) {
        const success = await handleCommentSubmit(toolId, commentText);
        if (success) {
          input.value = '';
        }
      }
    });
  });
}

function resetFilters() {
  cat = 'all';
  price = 'all';
  sort = 'votes';
  query = '';
  activeUseCase = '';
  document.getElementById('searchInput').value = '';
  document.getElementById('priceFilter').value = 'all';
  document.getElementById('sortFilter').value = 'votes';
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  document.querySelector('[data-scope="all"]').classList.add('active');
  document.querySelectorAll('.quick-card').forEach(c => c.classList.remove('active'));
  applyFilters();
}
</script>
</body>
</html>